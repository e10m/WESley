name: Data Processing Unit Tests

on: [push, pull_request]

jobs:
  test_data_processing:  # ← Added colon
    strategy:
      matrix:
        include:
          - test: tests/modules/trim_adapters.nf.test
            container: quay.io/biocontainers/trim-galore:0.6.6--0  # ← Fixed indentation
          - test: tests/modules/fastqc.nf.test
            container: biocontainers/fastqc:v0.11.9_cv8  # ← Fixed indentation
          - test: tests/modules/align.nf.test
            container: e10m/bwa-and-samtools:latest  # ← Fixed indentation
    
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Setup nf-test
        uses: ./.github/actions/setup-nf-test  # ← Fixed path (removed extra dot)

      - name: Pull respective Docker container
        run: docker pull ${{ matrix.container }}

      - name: Run nf-test
        shell: bash -el {0}
        working-directory: ./nextflow_automation/data_processing  # ← Optional: removed trailing slash
        run: nf-test test ${{ matrix.test }}