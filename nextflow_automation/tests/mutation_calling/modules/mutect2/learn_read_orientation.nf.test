nextflow_process {

    name "Test Process LEARN_READ_ORIENTATION"
    script "../../../../mutation_calling/modules/mutect2/learn_read_orientation.nf"
    process "LEARN_READ_ORIENTATION"
    config "../../../shared-test.config"

    test("Should process learn read orientation for paired calls without failing") {

        when {
            params {
                test_data = "${projectDir}/test-data"
            }
            process {
                """
                input[0] = [
                    'test', 
                    'testT', 
                    'testN',
                    file('${params.test_data}/vcfs/test.mutect2.paired.vcf'),
                    file('${params.test_data}/f1r2/test.f1r2.tar.gz')
                ]
                """
            }
        }

        then {
            assert process.success
            assert process.out.size() == 1

            with(process.out[0][0]) {
                assert size() == 5
                assert get(0) == 'test'
                assert get(1) == 'testT'
                assert get(2) == 'testN'
                assert file(get(3)).name == 'test.mutect2.paired.vcf'
                assert file(get(4)).name == 'test.read-orientation-model.tar.gz'
            }
        }

    }

    test("Should process learn read orientation for tumor only calls without failing") {

        when {
            params {
                test_data = "${projectDir}/test-data"
            }
            process {
                """
                input[0] = [
                    'test', 
                    'testT', 
                    'testN',
                    file('${params.test_data}/vcfs/test.mutect2.tumorOnly.vcf'),
                    file('${params.test_data}/f1r2/test.f1r2.tar.gz')
                ]
                """
            }
        }

        then {
            assert process.success
            assert process.out.size() == 1

            with(process.out[0][0]) {
                assert size() == 5
                assert get(0) == 'test'
                assert get(1) == 'testT'
                assert get(2) == 'testN'
                assert file(get(3)).name == 'test.mutect2.tumorOnly.vcf'
                assert file(get(4)).name == 'test.read-orientation-model.tar.gz'
            }
        }

    }

}