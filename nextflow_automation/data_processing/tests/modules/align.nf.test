nextflow_process {
    name "Test Process BWA_ALIGN"
    tag "alignment-test"
    script "modules/align.nf"
    process "BWA_ALIGN"

    test("Should align with bwa-mem without failures") {

        when {
            params {
                // creating parameter for easy access to test data
                test_data = "${projectDir}/test-data/fastqs"
                cpus = 1
                ref_dir = "${projectDir}/test-data/references"
                ref_genome = "${projectDir}/test-data/references/Homo_sapiens_assembly38_chr20.fasta"

            }
            process {
                // required inputs for test data
                """
                input[0] = [
                    'dummy',
                    'L001',
                    file("${params.test_data}/dummy_t_R1_xxx.fastq.gz", checkIfExists: true),
                    file("${params.test_data}/dummy_t_R2_xxx.fastq.gz", checkIfExists: true),
                    'illumina_novaseq_x',
                    'tcgb',
                    false
                ]
                """
            }
        }

        then {
            // check the process succeeded without error messages
            assert process.success

            // checking outputs
            with(process.out[0]) {
                // check if two items in the output tuple
                assert size() == 2

                // check if the outputs are as expected
                assert it[0] == 'dummy'
                assert it[1].name == 'dummy_L001.sorted.bam'
            }
        }
    }

}
