nextflow_workflow {

    name "Test Workflow data_processing.nf"
    script "data_processing.nf"
    workflow "DATA_PROCESSING"

    test("Should run data_processing.nf workflow end-to-end without failures") {

        when {
            params {
                test_mode = true
                cpus = 1
                base_dir = "${projectDir}/test-data/"
                ref_dir = "${projectDir}/test-data/references"
                metadata = "${projectDir}/test-data/tsvs/dummy_meta_sheet.tsv"
                test_metadata = "${projectDir}/test-data/tsvs/dummy_meta_sheet.tsv"
            }
        }

        then {
            // check if processes ran successfully
            assert workflow.out.fastqc_files != null
            assert workflow.out.fastqc_files.size() == 2

            assert workflow.out.trimmed_fastqs != null
            assert workflow.out.trimmed_fastqs.size() == 7

            // check entire workflow ran
            assert workflow.success
            assert workflow.trace.succeeded().size() > 0
        }
    }
}