nextflow.enable.dsl=2

// create parameters (can be altered via command line)
params {
    base_dir = "/media/graeberlab/wdtwo/dmach/test_fastqs/nf-batch-18"
    ref_dir = "/media/graeberlab/wdtwo/dmach/references"
    metadata = "/media/graeberlab/wdtwo/dmach/wes_pipeline/revamp_files/nextflow_automation/mutation_calling/batch123_mc_metasheet.tsv"
    batch_number = 20
    cpus = 35
    app_dir = "/media/graeberlab/wdtwo/dmach/app"
}

process {
    executor = 'local'
    containerOptions = "-v ${params.ref_dir}:/references"
    
    withName: MAKE_JSON {
        container = 'ubuntu:20.04'
    }

    withName: PILEUP {
        container = 'quay.io/biocontainers/samtools:1.10--h9402c20_1'
    }

    withName: MUTECT2 {
        executor = 'local'
        container = null  // disable container
    }

    withName: MUSE {
        container = 'quay.io/biocontainers/muse:1.0.rc--1'
    }

    withName: VARSCAN2 {
        container = 'e10m/varscan2:latest'
    }

    withName: MERGE_VCFS {
        container = 'broadinstitute/gatk:4.2.0.0'
    }

    withName: INDEX {
        container = 'quay.io/biocontainers/samtools:1.10--h9402c20_1'
    }
    withName: SELECT_VARIANTS {
        container = 'broadinstitute/gatk:4.2.0.0'
    }
    withName: VEP {
        container = 'e10m/vep:106.1'
    }
    withName: REHEADER {
        container = 'staphb/bcftools:1.10.2'
    }
    withName: CREATE_MAF {
        container = 'e10m/vcf2maf:1.6.19'
    }
    withName: KEEP_NONSYNONYMOUS {
        container = 'ubuntu:20.04'
    }
    withName: RENAME_HG38 {
        container = 'ubuntu:20.04'
    }
    withName: ONCOKB {
        container = 'e10m/oncokb:3.0.0'
        containerOptions = "-v ${params.ref_dir}:/references --env ONCOKB_TOKEN"
    }
}

docker {
    enabled = true
    runOptions = '--user $(id -u):$(id -g)'
}
